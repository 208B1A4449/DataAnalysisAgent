from langchain_groq import ChatGroq
from config import MODEL_NAME, GROQ_API_KEY

llm = ChatGroq(
    model=MODEL_NAME,
    temperature=0,
    api_key=GROQ_API_KEY
)

def repair_agent(question: str, code: str, error: str, schema: str) -> str:
    prompt = f"""
You are fixing a pandas expression generated by an LLM.

Dataset schema:
{schema}

User question:
{question}

Original code:
{code}

Execution error:
{error}

STRICT RULES:
- Return ONLY a single pandas expression
- No function definitions
- No lambda
- No imports
- No assignments
- Use df or numeric_df only
- No explanations
- Single line only

Correct the code.
"""
    fixed_code = llm.invoke(prompt).content.strip()
    return fixed_code.split("\n")[0].strip("`")
